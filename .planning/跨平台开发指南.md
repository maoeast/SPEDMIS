# SPEDMIS è·¨å¹³å°å¼€å‘æŒ‡å—

**åœºæ™¯**: A ç”µè„‘ (Linux) å¼€å‘æ–°åŠŸèƒ½ â†’ B ç”µè„‘ (Windows 10) è¿è¡Œ/æ‰“åŒ…

---

## âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹

### 1. å¯†é’¥ç®¡ç†ï¼ˆæœ€é‡è¦ï¼‰

**é—®é¢˜**: æ¿€æ´»ç éªŒè¯ä¾èµ–å¯†é’¥ï¼ŒLinux å’Œ Windows å¿…é¡»ä½¿ç”¨**å®Œå…¨ç›¸åŒçš„å¯†é’¥**

**è§£å†³æ–¹æ¡ˆ**:

```bash
# åœ¨ Linux å¼€å‘æœºä¸Šåˆ›å»º .env æ–‡ä»¶
cd /persistent/home/maodong/my\ code/SPEDMIS
cat > .env << EOF
# æ¿€æ´»ç³»ç»Ÿå¯†é’¥ï¼ˆ32 å­—ç¬¦ä»¥ä¸Šï¼‰
ACTIVATION_SECRET_KEY=ShineCanSpecialEducationMultiModalInterventionSystem2025

# AES åŠ å¯†å¯†é’¥ï¼ˆ32 å­—èŠ‚/64 ä½åå…­è¿›åˆ¶ï¼‰
ACTIVATION_ENCRYPTION_KEY=0123456789abcdef0123456789abcdef

# AES åˆå§‹åŒ–å‘é‡ï¼ˆ16 å­—èŠ‚/32 ä½åå…­è¿›åˆ¶ï¼‰
ACTIVATION_ENCRYPTION_IV=0123456789abcdef

# çŽ¯å¢ƒæ ‡è¯†
NODE_ENV=development
EOF
```

**åœ¨ Windows æ‰“åŒ…æœºä¸Š**ï¼ˆäºŒé€‰ä¸€ï¼‰:

```powershell
# æ–¹æ¡ˆ A: ç³»ç»ŸçŽ¯å¢ƒå˜é‡ï¼ˆæŽ¨èï¼‰
[Environment]::SetEnvironmentVariable("ACTIVATION_SECRET_KEY", "ShineCanSpecialEducationMultiModalInterventionSystem2025", "Machine")
[Environment]::SetEnvironmentVariable("ACTIVATION_ENCRYPTION_KEY", "0123456789abcdef0123456789abcdef", "Machine")
[Environment]::SetEnvironmentVariable("ACTIVATION_ENCRYPTION_IV", "0123456789abcdef", "Machine")
[Environment]::SetEnvironmentVariable("NODE_ENV", "production", "Machine")
```

```powershell
# æ–¹æ¡ˆ B: .env æ–‡ä»¶
# å¤åˆ¶ Linux ä¸Šçš„ .env æ–‡ä»¶åˆ° Windows é¡¹ç›®ç›®å½•
# æˆ–ä½¿ç”¨å†…åµŒå¯†é’¥æ–‡ä»¶ embedded-secrets.js
```

**âš ï¸ è­¦å‘Š**: å¯†é’¥ä¸ä¸€è‡´ä¼šå¯¼è‡´æ¿€æ´»ç éªŒè¯å¤±è´¥ï¼

---

### 2. ç¡¬ä»¶æ£€æµ‹å…¼å®¹æ€§

**å½“å‰çŠ¶æ€**: `hardware.js` å·²ä¿®å¤ï¼Œæ”¯æŒ Linux å’Œ Windows

| å‡½æ•° | Linux å‘½ä»¤ | Windows å‘½ä»¤ |
|------|-----------|-------------|
| `getHardDiskSerial` | `lsblk`, `hdparm`, `dmidecode -t disk` | `wmic diskdrive get SerialNumber` |
| `getMotherboardSerial` | `dmidecode -t baseboard`, `lshw` | `wmic baseboard get serialnumber` |
| `getCpuSerial` | `/proc/cpuinfo`, `dmidecode -t processor` | `wmic cpu get ProcessorId` |
| `getMacAddress` | `os.networkInterfaces()` (é€šç”¨) | `os.networkInterfaces()` (é€šç”¨) |

**æ³¨æ„**: 
- Linux å’Œ Windows èŽ·å–çš„ç¡¬ä»¶ ID **å®Œå…¨ä¸åŒ**
- åŒä¸€å°æœºå™¨çš„ Linux å’Œ Windows åŒç³»ç»Ÿä¼šç”Ÿæˆ**ä¸åŒçš„æœºå™¨ç **
- éœ€è¦åˆ†åˆ«ä¸º Linux å’Œ Windows ç”Ÿæˆæ¿€æ´»ç 

---

### 3. æž„å»ºé…ç½®

**å½“å‰ package.json é…ç½®**:

```json
{
  "scripts": {
    "build": "npm run prebuild && cross-env NODE_ENV=production electron-builder --win --x64"
  },
  "build": {
    "win": {
      "target": ["nsis"],
      "icon": "images/icon.ico"
    }
  }
}
```

**é—®é¢˜**: å½“å‰åªé…ç½®äº† Windows æž„å»º

**å¦‚éœ€åœ¨ Linux ä¸Šæž„å»º Windows åº”ç”¨**:
```bash
# å¯ä»¥ï¼Œä½†éœ€è¦ Wine å’Œ nsis å·¥å…·
sudo apt install wine nsis
npm run build
```

**æŽ¨è**: åœ¨ Windows ä¸Šè¿›è¡Œæœ€ç»ˆæ‰“åŒ…ï¼ŒLinux ä»…ç”¨äºŽå¼€å‘

---

### 4. è·¯å¾„å¤„ç†

**é—®é¢˜**: Windows ç”¨ `\`, Linux ç”¨ `/`

**ä»£ç ä¸­å·²å¤„ç†çš„ä½ç½®**:
```javascript
// main.js - ä½¿ç”¨ path.join() å¤„ç†è·¯å¾„
const path = require('path');
const storagePath = config.getActivationStoragePath(); // å†…éƒ¨ä½¿ç”¨ path.join
```

**éœ€è¦æ£€æŸ¥çš„ä»£ç **:
- âŒ é¿å…ç¡¬ç¼–ç è·¯å¾„ï¼š`'C:\\Users\\...'` æˆ– `'/home/...'`
- âœ… ä½¿ç”¨ `path.join(__dirname, '...')`
- âœ… ä½¿ç”¨ `app.getPath('appData')` èŽ·å–è·¨å¹³å°åº”ç”¨æ•°æ®ç›®å½•

---

### 5. åŽŸç”Ÿæ¨¡å—é‡æ–°ç¼–è¯‘

**é—®é¢˜**: `sql.js` ç­‰åŽŸç”Ÿæ¨¡å—éœ€è¦ä¸ºæ¯ä¸ªå¹³å°é‡æ–°ç¼–è¯‘

```bash
# Linux å¼€å‘çŽ¯å¢ƒ
npm rebuild --target=23.0.0 --disturl=https://electronjs.org/headers

# Windows æ‰“åŒ…çŽ¯å¢ƒ
npm rebuild --target=23.0.0 --disturl=https://electronjs.org/headers
# æˆ–åœ¨ Windows ä¸Šç›´æŽ¥ npm installï¼ˆä¼šè‡ªåŠ¨ç¼–è¯‘ï¼‰
```

**æŽ¨è**: ä¸è¦åœ¨ Linux ä¸Š `npm install` åŽæŠŠ `node_modules` å¤åˆ¶åˆ° Windows

---

## ðŸ“‹ è·¨å¹³å°å¼€å‘å·¥ä½œæµ

### åœºæ™¯ 1: Linux å¼€å‘ â†’ Windows æ‰“åŒ…

```bash
# ============ Linux (A ç”µè„‘) ============
# 1. å¼€å‘æ–°åŠŸèƒ½
cd /persistent/home/maodong/my\ code/SPEDMIS
# ç¼–è¾‘ä»£ç ...

# 2. æœ¬åœ°æµ‹è¯•
npm start

# 3. æäº¤ä»£ç åˆ°ç‰ˆæœ¬æŽ§åˆ¶
git add .
git commit -m "feat: æ–°åŠŸèƒ½"
git push origin main

# ============ Windows (B ç”µè„‘) ============
# 1. æ‹‰å–æœ€æ–°ä»£ç 
cd C:\Projects\SPEDMIS
git pull origin main

# 2. é…ç½®çŽ¯å¢ƒå˜é‡ï¼ˆé¦–æ¬¡ï¼‰
[Environment]::SetEnvironmentVariable("ACTIVATION_SECRET_KEY", "ShineCanSpecialEducationMultiModalInterventionSystem2025", "Machine")
[Environment]::SetEnvironmentVariable("ACTIVATION_ENCRYPTION_KEY", "0123456789abcdef0123456789abcdef", "Machine")
[Environment]::SetEnvironmentVariable("ACTIVATION_ENCRYPTION_IV", "0123456789abcdef", "Machine")
[Environment]::SetEnvironmentVariable("NODE_ENV", "production", "Machine")

# 3. å®‰è£…ä¾èµ–ï¼ˆä¸è¦å¤åˆ¶ node_modulesï¼ï¼‰
npm install

# 4. æµ‹è¯•è¿è¡Œ
npm start

# 5. æž„å»ºæ‰“åŒ…
npm run build

# è¾“å‡ºï¼šdist\ç‰¹æ®Šæ•™è‚²å¤šæ¨¡æ€å¹²é¢„ç³»ç»Ÿ*.exe
```

---

### åœºæ™¯ 2: å¯†é’¥åŒæ­¥

**æŽ¨èæ–¹æ¡ˆ**: ä½¿ç”¨å†…åµŒå¯†é’¥æ–‡ä»¶

```javascript
// åˆ›å»º embedded-secrets.jsï¼ˆä¸¤å°æœºå™¨éƒ½åˆ›å»ºï¼‰
module.exports = {
    activationSecretKey: 'ShineCanSpecialEducationMultiModalInterventionSystem2025',
    encryptionKey: '0123456789abcdef0123456789abcdef',
    encryptionIV: '0123456789abcdef'
};
```

**å®‰å…¨æç¤º**:
- âš ï¸ å°† `embedded-secrets.js` æ·»åŠ åˆ° `.gitignore`
- ðŸ” ä½¿ç”¨ U ç›˜æˆ–åŠ å¯†é€šé“ä¼ è¾“å¯†é’¥æ–‡ä»¶
- ðŸš« ä¸è¦é€šè¿‡é‚®ä»¶/å³æ—¶é€šè®¯å‘é€å¯†é’¥

---

### åœºæ™¯ 3: æ¿€æ´»ç ç”Ÿæˆ

**é‡è¦**: Linux å’Œ Windows çš„æœºå™¨ç ä¸åŒï¼Œéœ€è¦åˆ†åˆ«ç”Ÿæˆæ¿€æ´»ç 

```bash
# ============ Linux æœºå™¨ç  ============
# åœ¨ Linux ä¸Šè¿è¡Œ app èŽ·å–
æœºå™¨ç ï¼š710085159ae63da2f5c9ecdf3857d7b0ab96b64063ba594244e6dda71c6f44b7

# ä½¿ç”¨ Linux æœºå™¨ç ç”Ÿæˆæ¿€æ´»ç 
node tools/activation-code-generator.js 710085159ae63da2f5c9ecdf3857d7b0ab96b64063ba594244e6dda71c6f44b7
æ¿€æ´»ç ï¼š43f7c88aea91030043ce5a5ddf30bc71f658b77cd18900b4534c885f89e8ea8c

# ============ Windows æœºå™¨ç  ============
# åœ¨ Windows ä¸Šè¿è¡Œ app èŽ·å–ï¼ˆä¸åŒçš„æœºå™¨ç ï¼ï¼‰
æœºå™¨ç ï¼šxxxxxxxx...

# ä½¿ç”¨ Windows æœºå™¨ç ç”Ÿæˆæ¿€æ´»ç 
node tools/activation-code-generator.js xxxxxx...
æ¿€æ´»ç ï¼šyyyyyy...
```

---

## âœ… è·¨å¹³å°æ£€æŸ¥æ¸…å•

### å¼€å‘çŽ¯å¢ƒï¼ˆLinuxï¼‰
- [ ] `.env` æ–‡ä»¶å·²åˆ›å»ºï¼ŒåŒ…å«æ­£ç¡®å¯†é’¥
- [ ] `hardware.js` Linux å‘½ä»¤å·²æµ‹è¯•
- [ ] æœ¬åœ° `npm start` è¿è¡Œæ­£å¸¸
- [ ] æ¿€æ´»åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] ä»£ç å·²æäº¤åˆ° Git

### æ‰“åŒ…çŽ¯å¢ƒï¼ˆWindowsï¼‰
- [ ] ä»Ž Git æ‹‰å–æœ€æ–°ä»£ç 
- [ ] çŽ¯å¢ƒå˜é‡å·²é…ç½®ï¼ˆæˆ– embedded-secrets.js å·²åˆ›å»ºï¼‰
- [ ] å…¨æ–° `npm install`ï¼ˆä¸å¤åˆ¶ node_modulesï¼‰
- [ ] `npm start` æµ‹è¯•è¿è¡Œæ­£å¸¸
- [ ] `npm run build` æž„å»ºæˆåŠŸ
- [ ] å®‰è£…ç¨‹åºæµ‹è¯•é€šè¿‡

### æ¿€æ´»æµ‹è¯•
- [ ] Linux æœºå™¨ç å·²èŽ·å–
- [ ] Linux æ¿€æ´»ç å·²ç”Ÿæˆå¹¶æµ‹è¯•
- [ ] Windows æœºå™¨ç å·²èŽ·å–
- [ ] Windows æ¿€æ´»ç å·²ç”Ÿæˆå¹¶æµ‹è¯•
- [ ] ä¸¤å°æœºå™¨çš„æ¿€æ´»å¯†é’¥ä¸€è‡´

---

## ðŸ› å¸¸è§é—®é¢˜æŽ’æŸ¥

### é—®é¢˜ 1: "æ¿€æ´»ç æ— æ•ˆ"
```
åŽŸå› ï¼šå¯†é’¥ä¸åŒ¹é…
è§£å†³ï¼š
1. æ£€æŸ¥ Linux å’Œ Windows ä½¿ç”¨ç›¸åŒçš„ ACTIVATION_SECRET_KEY
2. éªŒè¯ .env æˆ–çŽ¯å¢ƒå˜é‡å·²æ­£ç¡®è®¾ç½®
3. é‡å¯åº”ç”¨ä½¿çŽ¯å¢ƒå˜é‡ç”Ÿæ•ˆ
```

### é—®é¢˜ 2: "machineCode ä¸º UNKNOWN"
```
åŽŸå› ï¼šhardware.js å¹³å°å‘½ä»¤ä¸å…¼å®¹
è§£å†³ï¼š
1. æ£€æŸ¥ hardware.js ä¸­å¯¹åº”å¹³å°çš„å‘½ä»¤
2. Linux ç¡®è®¤ dmidecodeã€lshw å·²å®‰è£…
3. Windows ç¡®è®¤ wmic å¯ç”¨
```

### é—®é¢˜ 3: "npm install åŽæ— æ³•è¿è¡Œ"
```
åŽŸå› ï¼šåŽŸç”Ÿæ¨¡å—å¹³å°ä¸å…¼å®¹
è§£å†³ï¼š
1. åˆ é™¤ node_modules
2. åœ¨ç›®æ ‡å¹³å°é‡æ–° npm install
3. ä¸è¦è·¨å¹³å°å¤åˆ¶ node_modules
```

### é—®é¢˜ 4: "è·¯å¾„é”™è¯¯"
```
åŽŸå› ï¼šè·¯å¾„åˆ†éš”ç¬¦ç¡¬ç¼–ç 
è§£å†³ï¼š
1. ä½¿ç”¨ path.join() ä»£æ›¿å­—ç¬¦ä¸²æ‹¼æŽ¥
2. ä½¿ç”¨ app.getPath() èŽ·å–ç³»ç»Ÿè·¯å¾„
3. æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶è·¯å¾„å¼•ç”¨
```

---

## ðŸ“¦ æŽ¨èé¡¹ç›®ç»“æž„

```
SPEDMIS/
â”œâ”€â”€ .env                    # æœ¬åœ°å¯†é’¥ï¼ˆä¸æäº¤åˆ° Gitï¼‰
â”œâ”€â”€ .env.example            # å¯†é’¥æ¨¡æ¿ï¼ˆå¯æäº¤ï¼‰
â”œâ”€â”€ .gitignore              # åŒ…å« embedded-secrets.js
â”œâ”€â”€ embedded-secrets.js     # å†…åµŒå¯†é’¥ï¼ˆå¯é€‰ï¼Œä¸æäº¤ï¼‰
â”œâ”€â”€ package.json            # æž„å»ºé…ç½®
â”œâ”€â”€ hardware.js             # è·¨å¹³å°ç¡¬ä»¶æ£€æµ‹
â”œâ”€â”€ main.js                 # Electron ä¸»è¿›ç¨‹
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ activation-code-generator.js  # æ¿€æ´»ç ç”Ÿæˆå·¥å…·
â””â”€â”€ .planning/
    â””â”€â”€ è·¨å¹³å°å¼€å‘æŒ‡å—.md   # æœ¬æ–‡æ¡£
```

---

## ðŸ“ž å¿«é€Ÿå‚è€ƒ

### çŽ¯å¢ƒå˜é‡ï¼ˆWindowsï¼‰
```powershell
# æŸ¥çœ‹å½“å‰çŽ¯å¢ƒå˜é‡
[Environment]::GetEnvironmentVariable("ACTIVATION_SECRET_KEY", "Machine")

# åˆ é™¤çŽ¯å¢ƒå˜é‡
[Environment]::SetEnvironmentVariable("ACTIVATION_SECRET_KEY", $null, "Machine")
```

### çŽ¯å¢ƒå˜é‡ï¼ˆLinuxï¼‰
```bash
# æŸ¥çœ‹å½“å‰çŽ¯å¢ƒå˜é‡
echo $ACTIVATION_SECRET_KEY

# ä¸´æ—¶è®¾ç½®ï¼ˆå½“å‰ç»ˆç«¯ï¼‰
export ACTIVATION_SECRET_KEY="your-key"
```

### æž„å»ºå‘½ä»¤
```bash
# å¼€å‘è¿è¡Œ
npm start

# æž„å»º Windows å®‰è£…åŒ…
npm run build

# é‡å»ºåŽŸç”Ÿæ¨¡å—
npm rebuild
```

---

**æœ€åŽæ›´æ–°**: 2026-02-28  
**é€‚ç”¨ç‰ˆæœ¬**: SPEDMIS 1.1.0
