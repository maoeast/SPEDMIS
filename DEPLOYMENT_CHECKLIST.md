# 生产部署最终检查清单

**应用**: 特殊教育多模态干预系统  
**版本**: 1.0.0  
**发布日期**: 2024-12-16  
**部署日期**: ___________

---

## 预部署检查 (72小时前)

### 代码审查
- [ ] 所有安全补丁已集成
- [ ] P0 安全问题 4 个全部修复
  - [ ] SECRET_KEY 环境变量化
  - [ ] MD5→SHA-256 机器码升级
  - [ ] 激活信息 AES-256-GCM 加密
  - [ ] 虚拟机检测机制
- [ ] 功能更新已完成
  - [ ] 产品信息个性化设置
  - [ ] 返回按钮样式统一
  - [ ] 模块设置按钮移除
  - [ ] 应用图标映射修复
  - [ ] IPC 通信优化
  - [ ] 使用统计系统

### 测试验证
- [ ] 99/99 单元测试通过
- [ ] 代码质量检查通过
- [ ] 没有编译警告

### 文档准备
- [ ] DEPLOYMENT_GUIDE.md 已准备
- [ ] RELEASE_NOTES.md 已准备
- [ ] 激活码生成工具已更新
- [ ] 技术支持文档已准备

### 备份准备
- [ ] 源代码已备份到版本控制
- [ ] 构建配置已备份
- [ ] 数据库初始化脚本已备份

---

## 构建阶段 (24小时前)

### 环境准备
```powershell
# 确认版本
node --version        # 应 >= v16.0.0
npm --version        # 应 >= 8.0.0
electron --version   # 应 = 23.0.0
```

- [ ] Node.js >= 16.0.0 已安装
- [ ] npm >= 8.0.0 已安装
- [ ] 依赖已安装 (npm install)
- [ ] 磁盘空间 >= 2GB 可用

### 密钥生成和配置
```powershell
# 生成加密密钥
$key = [System.Security.Cryptography.RandomNumberGenerator]::GetBytes(32)
$hex = $key | ForEach-Object { '{0:x2}' -f $_ } | Join-String
Write-Output "ACTIVATION_ENCRYPTION_KEY=$hex"

# 生成 IV
$iv = [System.Security.Cryptography.RandomNumberGenerator]::GetBytes(16)
$hex = $iv | ForEach-Object { '{0:x2}' -f $_ } | Join-String
Write-Output "ACTIVATION_ENCRYPTION_IV=$hex"
```

- [ ] ACTIVATION_SECRET_KEY 已生成 (长度 >= 32)
- [ ] ACTIVATION_ENCRYPTION_KEY 已生成 (64 个十六进制字符)
- [ ] ACTIVATION_ENCRYPTION_IV 已生成 (32 个十六进制字符)
- [ ] 密钥已保存到安全位置
- [ ] 密钥管理计划已制定

### 环境变量配置

**选项 A: 系统环境变量**
```powershell
[Environment]::SetEnvironmentVariable("ACTIVATION_SECRET_KEY", "你的密钥值", "Machine")
[Environment]::SetEnvironmentVariable("ACTIVATION_ENCRYPTION_KEY", "你的密钥值", "Machine")
[Environment]::SetEnvironmentVariable("ACTIVATION_ENCRYPTION_IV", "你的IV值", "Machine")
[Environment]::SetEnvironmentVariable("NODE_ENV", "production", "Machine")
[Environment]::SetEnvironmentVariable("ENABLE_VM_DETECTION", "true", "Machine")
```

- [ ] 密钥环境变量已设置 (Machine scope)
- [ ] NODE_ENV 已设置为 production
- [ ] ENABLE_VM_DETECTION 已设置为 true
- [ ] 密钥权限已限制 (仅管理员可读)

**选项 B: .env 文件**
```bash
ACTIVATION_SECRET_KEY=你的密钥值
ACTIVATION_ENCRYPTION_KEY=你的密钥值
ACTIVATION_ENCRYPTION_IV=你的IV值
NODE_ENV=production
ENABLE_VM_DETECTION=true
```

- [ ] .env 文件已创建
- [ ] .env 文件权限为 600 (仅所有者)
- [ ] .env 已添加到 .gitignore
- [ ] .env 文件不在版本控制中

### 构建执行

```powershell
# 方法 1: 使用部署脚本（推荐）
.\deploy.ps1 -Mode full

# 方法 2: 手动构建
npm run build
```

- [ ] `npm test` 通过
- [ ] `node pre-deployment-checklist.js` 通过
- [ ] `npm run build` 成功完成
- [ ] dist\特殊教育多模态干预系统*.exe 已生成
- [ ] 安装程序大小合理 (50-200 MB)
- [ ] 构建过程无错误或警告

### 构建输出验证
```powershell
# 检查输出文件
Get-ChildItem dist\*.exe
Get-ChildItem dist\*.nsis
Get-Item dist\builder-effective-config.yaml
```

- [ ] exe 安装程序存在
- [ ] 文件大小检查无异常
- [ ] 数字签名（如配置）已应用
- [ ] 构建日志已保存

---

## 测试阶段 (12小时前)

### 功能测试环境
- [ ] 虚拟机或物理测试机已准备
- [ ] 清洁系统环境（无旧版本）
- [ ] 网络连接正常
- [ ] 日志级别设置为 DEBUG (便于排查)

### 安装测试

#### 安装流程
- [ ] 双击 exe 安装程序
- [ ] 接受许可协议
- [ ] 选择安装路径
- [ ] 创建开始菜单快捷方式
- [ ] 创建桌面快捷方式
- [ ] 安装完成提示显示
- [ ] 应用成功启动

#### 激活流程
- [ ] 显示激活页面
- [ ] 获取机器码功能正常
- [ ] 机器码复制功能正常
- [ ] 激活码输入框接受输入
- [ ] 输入有效激活码后激活成功
- [ ] 自动进入主界面
- [ ] 激活信息已保存（查看日志）

### 功能测试

#### 产品信息
- [ ] 首页标题显示中文产品名
- [ ] 副标题显示英文产品名
- [ ] 页脚显示版权和组织信息
- [ ] 高级设置可修改产品信息
- [ ] 修改后立即生效

#### 模块功能
- [ ] 首页显示 5 个主模块
- [ ] 点击模块进入二级页面
- [ ] 应用列表正确加载
- [ ] 应用图标全部显示正确
- [ ] 没有"无法找到图标"的警告

#### 使用统计
- [ ] 进入应用时记录开始时间
- [ ] 离开应用时记录结束时间
- [ ] 统计页面数据正确展示
- [ ] 图表和表格呈现正常
- [ ] 导出数据功能正常

#### 虚拟机检测
- [ ] 物理机运行：无虚拟机警告 ✓
- [ ] 虚拟机运行：显示虚拟机警告 ✓
- [ ] 日志记录检测结果 ✓
- [ ] 应用继续正常运行 ✓

### 性能测试

#### 启动性能
- [ ] 应用启动时间 < 5 秒
- [ ] 首次激活完成时间 < 10 秒
- [ ] 模块加载时间 < 3 秒
- [ ] 无明显卡顿或延迟

#### 内存使用
- [ ] 初始内存占用 < 150 MB
- [ ] 长期运行内存稳定
- [ ] 没有明显内存泄漏

### 错误测试

#### 边界情况
- [ ] 无效的激活码输入：显示错误提示
- [ ] 空激活码输入：显示错误提示
- [ ] 多次激活失败：正确限制重试
- [ ] 网络断开：应用继续正常运行（使用本地激活）

#### 异常处理
- [ ] 删除激活文件后重启：返回激活页面
- [ ] 修改激活文件：检测篡改并提示
- [ ] 磁盘空间不足：正确提示和降级处理
- [ ] 日志记录所有错误

### 安全测试

#### 密钥管理
- [ ] config.js 中无硬编码密钥 ✓
- [ ] 激活信息以加密形式存储 ✓
- [ ] 加密数据不可直接读取 ✓
- [ ] 篡改激活文件会被检测 ✓

#### 权限验证
- [ ] 激活码生成与机器码匹配
- [ ] 不同机器的激活码不互通
- [ ] MD5 和 SHA-256 激活码都支持
- [ ] 旧版本升级兼容性正常

#### 虚拟机防护
- [ ] 虚拟机检测机制有效
- [ ] 检测结果记录到日志
- [ ] 虚拟机环境识别准确率 > 95%

---

## 预发布准备 (6小时前)

### 最终验证
- [ ] 所有测试用例通过
- [ ] 没有已知 BUG
- [ ] 性能指标达标
- [ ] 安全审计无问题

### 发布文件准备
- [ ] 安装程序文件已标记版本
  - 文件名: 特殊教育多模态干预系统_1.0.0.exe
- [ ] 发布说明 (RELEASE_NOTES.md) 已确认
- [ ] 部署指南 (DEPLOYMENT_GUIDE.md) 已确认
- [ ] 更新日志已准备
- [ ] 激活码生成工具已更新

### 用户通知准备
- [ ] 发布邮件已草稿
- [ ] FAQ 文档已准备
- [ ] 技术支持已培训
- [ ] 热线电话已开通

### 回滚计划
- [ ] 备份最新版本安装程序
- [ ] 旧版本安装程序已保留
- [ ] 回滚脚本已准备
- [ ] 紧急联系方式已确认

---

## 生产部署 (部署日)

### 发布前最后检查 (1小时)
- [ ] 部署区域清空闲置人员
- [ ] 技术支持团队已就位
- [ ] 监控系统已启动
- [ ] 备用方案已准备

### 发布执行

#### 发布时间: ____________

- [ ] 发布说明已发布
- [ ] 安装程序已上传到下载服务器
- [ ] 下载链接已激活
- [ ] 安装说明已通知用户
- [ ] FAQ 和技术支持文档已可访问

### 首小时监控

- [ ] 实时监控应用日志
- [ ] 监测激活失败率 (应 < 1%)
- [ ] 监测应用崩溃率 (应 = 0%)
- [ ] 监测用户反馈渠道
- [ ] 团队待命应对问题

#### 关键指标检查

```
激活相关：
  ✓ 新激活成功率 > 99%
  ✓ 激活失败错误日志清晰
  ✓ 激活性能 < 5秒

应用相关：
  ✓ 应用启动成功率 > 99%
  ✓ 模块加载无卡顿
  ✓ 没有内存泄漏

虚拟机相关：
  ✓ 虚拟机检测 > 95% 准确率
  ✓ 虚拟机日志记录完整
```

### 问题处理

如遇到问题:

- [ ] 收集详细的错误日志
- [ ] 确认问题的严重程度
- [ ] 评估是否需要回滚
  
**严重问题触发回滚条件:**
- 激活失败率 > 10%
- 应用崩溃率 > 5%
- 安全漏洞被发现
- 核心功能无法使用

回滚流程:
- [ ] 停止新版本下载
- [ ] 恢复旧版本安装链接
- [ ] 向用户发送回滚通知
- [ ] 根因分析和修复
- [ ] 准备新的发布版本

---

## 发布后 (24小时)

### 监控总结
- [ ] 激活统计分析
- [ ] 应用性能指标
- [ ] 错误日志分析
- [ ] 用户反馈总结

### 问题处理
- [ ] 已知问题列表
- [ ] 修复优先级排序
- [ ] 紧急补丁计划 (如需要)
- [ ] 下个版本改进建议

### 文档更新
- [ ] 常见问题 (FAQ) 已更新
- [ ] 技术文档已更新
- [ ] 用户指南已更新

### 团队总结
- [ ] 部署经验总结
- [ ] 流程改进建议
- [ ] 下个版本计划讨论

---

## 部署签名

**部署负责人**: ________________________  
**日期**: ____________  
**时间**: ____________

**测试负责人**: ________________________  
**认可**: ☐ 通过 ☐ 有条件通过 ☐ 不通过

**技术支持主管**: ________________________  
**准备状态**: ☐ 已准备 ☐ 部分准备 ☐ 未准备

---

## 注意事项

⚠️ **关键项目 - 部署前必须完成:**
1. ✅ 密钥生成和环境配置
2. ✅ 99/99 单元测试通过
3. ✅ 预部署检查脚本通过
4. ✅ 测试环境功能验证
5. ✅ 虚拟机检测测试
6. ✅ 激活流程完整测试
7. ✅ 回滚计划准备

💡 **提示:**
- 保存此清单的完成副本作为审计记录
- 将部署日志备份至安全位置
- 在今后的版本更新中参考此流程

📞 **紧急联系方式:**
- 部署主管: _________________
- 技术支持: _________________
- 系统管理: _________________

---

**祝部署顺利！** 🚀
